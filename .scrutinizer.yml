build:
    nodes:
        talentcloud:
            dependencies:
                before:
                    - npm rebuild
                    - npm install
                    - make gen-certs
                    - sudo docker-compose up --abort-on-container-exit
                    - sudo make docker-start
                    - sudo cp -a .env.example .env
                    - make build-db
                    - make docker-stop

            root_path: './'

            environment:
                variables:
                    DB_HOST: "talentcloud-db"
                    DB_PORT: "5433"
                # Languages
                php:
                    version: "7.2"
                    ini:
                        memory_limit: "-1"
                ruby: "2.3.1"
                node: "v6.2.0"
                # Various pre-installed services that can be configured.
                docker: true
                postgresql: true
                selenium: true

        analysis:
            tests:
                override:
                    - php-scrutinizer-run --enable-security-analysis
                    - js-scrutinizer-run
                    - phpcs-run

filter:
    excluded_paths:
        - '*/database/*'
        - '*/node_modules/*'
        - '*/tests/*'
        - '*/vendor/*'

checks:
    php: true

tools:
    external_code_coverage:
        timeout: 777
        runs: 2
    custom_commands:
        -
            scope: project
            command: vendor/bin/slack --token=https://hooks.slack.com/services/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
